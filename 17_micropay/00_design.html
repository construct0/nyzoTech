<link rel="stylesheet" type="text/css" href="../style.css">

<h1>System design</h1>

<p>
    Micropay supports a number of different functionalities. New functionalities are in development.
</p>

<h2>Sending tips</h2>

<p>
    To allow users to send tips to you, first create an HTML element with the class
    <span class="code-mb">nyzo-tip-button</span>.
</p>

<p class="code-block">
    <span class="code-block-new-code">&ltdiv class="nyzo-tip-button"&gt</span><br>
    <span class="code-block-new-code">&lt/div&gt</span>
</p>

<p>
    Add the following data fields to the element:
</p>

<ul>
    <li><span class="code-mb">data-client-url</span>: the <span class="code-mb">forward<wbr>Transaction</span> URL on a
        Nyzo client</li>
    <li><span class="code-mb">data-receiver-id</span>: the public identifier of the account that will receive tips,
        encoded as a Nyzo string</li>
    <li><span class="code-mb">data-tag</span> (optional): the sender-data field for tip transactions, encoded as plain
        text or a normalized sender-data string</li>
</ul>

<p>
    With these fields, the element will look similar to the following.
</p>

<p class="code-block">
    &ltdiv class="nyzo-tip-button"<br>
    <span class="pad">    </span><span class="code-block-new-code">data-client-url="https://<wbr>client.<wbr>nyzo.<wbr>
    co/<wbr>api/<wbr>forward<wbr>Transaction"</span><br>
    <span class="pad">    </span><span class="code-block-new-code">data-receiver-id="id__8cdasP<wbr>C2QVZ13iG4<wbr>
    2RWhp47gow<wbr>9SsIXZgp0A<wbr>ga59oEITG2<wbr>X-M7Ur"</span><br>
    <span class="pad">    </span><span class="code-block-new-code">data-tag="thank you for the content!"</span>&gt<br>
    &lt/div&gt
</p>

<p>
    When the Nyzo extension loads, it searches for all elements of the class
    <span class="code-mb">nyzo-tip-button</span>. In addition to loading the data fields of these elements, the
    extension removes the <span class="code-mb">nyzo-extension-not-installed</span> class and adds the
    <span class="code-mb">nyzo-extension-installed</span> class.
</p>

<p>
    So, while not required, one may wish to add the <span class="code-mb">nyzo-extension-not-installed</span> class to a
    Nyzo tip element:
</p>

<p class="code-block">
    &ltdiv class="nyzo-tip-button <span class="code-block-new-code">nyzo-extension-not-installed</span>"<br>
    <span class="pad">    </span>data-client-url="https://<wbr>client.<wbr>nyzo.<wbr>co/<wbr>api/<wbr>forward<wbr>
    Transaction"<br>
    <span class="pad">    </span>data-receiver-id="id__8cdasP<wbr>C2QVZ13iG4<wbr>2RWhp47gow<wbr>9SsIXZgp0A<wbr>
    ga59oEITG2<wbr>X-M7Ur"<br>
    <span class="pad">    </span>data-tag="thank you for the content!"&gt<br>
    &lt/div&gt
</p>

<p>
    When the extension loads, the element above would change to:
</p>

<p class="code-block">
    &ltdiv class="nyzo-tip-button <span class="code-block-new-code">nyzo-extension-installed</span>"<br>
    <span class="pad">    </span>data-client-url="https://<wbr>client.<wbr>nyzo.<wbr>co/<wbr>api/<wbr>forward<wbr>
    Transaction"<br>
    <span class="pad">    </span>data-receiver-id="id__8cdasP<wbr>C2QVZ13iG4<wbr>2RWhp47gow<wbr>9SsIXZgp0A<wbr>
    ga59oEITG2<wbr>X-M7Ur"<br>
    <span class="pad">    </span>data-tag="thank you for the content!"&gt<br>
    &lt/div&gt
</p>

<p>
    Please note that the <span class="code-mb">nyzo-extension-installed</span> class will be added to all elements of
    the <span class="code-mb">nyzo-tip-button</span> class, regardless of whether the
    <span class="code-mb">nyzo-extension-not-installed</span> class is also present.
</p>

<p>
    Also, please note that the extension processes <span class="italic">all</span> elements of the
    <span class="code-mb">nyzo-tip-button</span> class. If multiple elements with valid
    <span class="code-mb">data-client-url</span> and <span class="code-mb">data-receiver-id</span> fields are found, the
    last element that the extension encounters will be used for the tip configuration that is presented to the user. To
    avoid potentially confusing behavior, we recommend that pages are written according to one of the two following
    rules:
</p>

<ul>
    <li>all elements of the <span class="code-mb">nyzo-tip-button</span> class have the same
        <span class="code-mb">data-</span> attributes</li>
    <li>only one element of the <span class="code-mb">nyzo-tip-button</span> class contains
        <span class="code-mb">data-</span> attributes</li>
</ul>

<p>
    When the Nyzo extension finds a correctly configured Micropay tip button, the extension will present a tip option in
    the popup menu. Tip amounts are determined <span class="italic">by the user</span> in the options menu. The user
    sets a base tip amount, and the extension provides buttons with values of 1x, 2x, and 5x the user-specified amount.
</p>

<img src="resources/design_tip_popup.png"
     alt="screenshot of extension popup showing tip buttons"
     class="code-image" style="width: 220px; max-height: 110px;">

<h2>Paying for content</h2>

<p>
    To allow users to purchase content with Nyzo Micropay, first create an element with the class
    <span class="code-mb">nyzo-micropay-button</span>.
</p>

<p class="code-block">
    <span class="code-block-new-code">&ltdiv class="nyzo-micropay-button"&gt</span><br>
    <span class="code-block-new-code">&lt/div&gt</span>
</p>

<p>
    Add the following data fields to the element:
</p>

<ul>
    <li><span class="code-mb">data-client-url</span>: the <span class="code-mb">forward<wbr>Transaction</span> URL on a
        Nyzo client</li>
    <li><span class="code-mb">data-receiver-id</span>: the public identifier of the account that will receive payments,
        encoded as a Nyzo string</li>
    <li><span class="code-mb">data-amount</span>: the minimum payment, in Nyzos, that will be accepted for purchase of
        the content</li>
    <li><span class="code-mb">data-display-name</span> (optional): a label to be displayed with the purchase button in
        the extension</li>
    <li><span class="code-mb">data-tag</span> (optional): the sender-data field for transactions, encoded as plain
        text or a normalized sender-data string</li>
</ul>

<p>
    With these fields, the element will look similar to the following.
</p>

<p class="code-block">
    &ltdiv class="nyzo-micropay-button"<br>
    <span class="pad">    </span><span class="code-block-new-code">data-client-url="https://<wbr>client.<wbr>nyzo.<wbr>
    co/<wbr>api/<wbr>forward<wbr>Transaction"</span><br>
    <span class="pad">    </span><span class="code-block-new-code">data-receiver-id="id__8cdasP<wbr>C2QVZ13iG4<wbr>
    2RWhp47gow<wbr>9SsIXZgp0A<wbr>ga59oEITG2<wbr>X-M7Ur"</span><br>
    <span class="pad">    </span><span class="code-block-new-code">data-amount="0.1"</span><br>
    <span class="pad">    </span><span class="code-block-new-code">data-display-name="Demo article"</span><br>
    <span class="pad">    </span><span class="code-block-new-code">data-tag="article"</span>&gt<br>
    &lt/div&gt
</p>

<p>
    When the Nyzo extension loads, it searches for all elements of the class
    <span class="code-mb">nyzo-micropay-button</span>. In addition to loading the data fields of these elements, the
    extension removes the <span class="code-mb">nyzo-extension-not-installed</span> class and adds the
    <span class="code-mb">nyzo-extension-installed</span> class.
</p>

<p>
    So, while not required, one may wish to add the <span class="code-mb">nyzo-extension-not-installed</span> class to
    Nyzo Micropay elements:
</p>

<p class="code-block">
    &ltdiv class="nyzo-micropay-button <span class="code-block-new-code">nyzo-extension-not-installed</span>"<br>
    <span class="pad">    </span>data-client-url="https://<wbr>client.<wbr>nyzo.<wbr>co/<wbr>api/<wbr>forward<wbr>
    Transaction"<br>
    <span class="pad">    </span>data-receiver-id="id__8cdasP<wbr>C2QVZ13iG4<wbr>2RWhp47gow<wbr>9SsIXZgp0A<wbr>
    ga59oEITG2<wbr>X-M7Ur"<br>
    <span class="pad">    </span>data-amount="0.1"<br>
    <span class="pad">    </span>data-display-name="Demo article"<br>
    <span class="pad">    </span>data-tag="article"&gt<br>
    &lt/div&gt
</p>

<p>
    When the extension loads, the element would change to:
</p>

<p class="code-block">
    &ltdiv class="nyzo-micropay-button <span class="code-block-new-code">nyzo-extension-installed</span>"<br>
    <span class="pad">    </span>data-client-url="https://<wbr>client.<wbr>nyzo.<wbr>co/<wbr>api/<wbr>forward<wbr>
    Transaction"<br>
    <span class="pad">    </span>data-receiver-id="id__8cdasP<wbr>C2QVZ13iG4<wbr>2RWhp47gow<wbr>9SsIXZgp0A<wbr>
    ga59oEITG2<wbr>X-M7Ur"<br>
    <span class="pad">    </span>data-amount="0.1"<br>
    <span class="pad">    </span>data-display-name="Demo article"<br>
    <span class="pad">    </span>data-tag="article"&gt<br>
    &lt/div&gt
</p>

<p>
    Please note that the <span class="code-mb">nyzo-extension-installed</span> class will be added to all elements of
    the <span class="code-mb">nyzo-micropay-button</span> class, regardless of whether the
    <span class="code-mb">nyzo-extension-not-installed</span> class is also present.
</p>

<p>
    When the Nyzo extension finds a correctly configured Micropay payment button, the extension will present the payment
    option in the popup menu.
</p>

<img src="resources/design_payment_popup_article.png" alt="screenshot of extension popup showing payment button"
     class="code-image" style="width: 220px; max-height: 110px;">

<p>
    When the user clicks the payment button, a transaction is generated and sent to the Nyzo client at the URL indicated
    by the <span class="code-mb">data-client-url</span> attribute of the Micropay button. If the client accepts the
    transaction, a success message is displayed.
</p>

<img src="resources/design_payment_popup_transaction_accepted.png"
     alt="screenshot of extension popup showing acceptance of Micropay transaction"
     class="code-image" style="width: 220px; max-height: 140px;">

<p class="italic">
    This section is not yet complete.
</p>

<h2>Playing games</h2>

<p>
    Micropay functionality for playing games was developed with the initial example of
    <a href="gameExample">tic-tac-toe</a>. More sophisticated games are in development.
</p>

<h2>Nyzo vault</h2>

<p>
    The <a href="vaultExample">vault example</a> shows how content can be registered and verified on the Nyzo
    blockchain.
</p>