<link rel="stylesheet" type="text/css" href="../style.css">

<h1>Game example</h1>

<p class="emphasis">
    This page requires version 4 or later of the Chrome extension to log the generated transactions.
</p>

<p>
    This will be an example of a simple game using Micropay. This will require updates to the Chrome extension to handle
    the dynamic nature of the transactions generated in the course of game play.
</p>

<p>
    This page generates five transactions at 5-second intervals. The extension will send them to the client for
    processing and follow their status as they are processed by the cycle.
</p>

<p>
    There will be six states for transactions.
</p>

<style>
    .transaction-waiting {
        background-color: #ccc;
    }
    .transaction-generated {
        background-color: #dfd;
    }
    .transaction-sent {
        background-color: #9f9;
    }
    .transaction-accepted {
        background-color: #0f0;
    }
    .transaction-processed {
        background-color: #0c0;
    }
    .transaction-failed {
        background-color: #f88;
    }
</style>

<div class="table">
    <div style="display: table-row;">
        <div style="display: table-cell; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem;"
             class="transaction-waiting">waiting</div>
    </div>
    <div class="data-row">
        <div class="transaction-generated">generated</div>
    </div>
    <div class="data-row">
        <div class="transaction-sent">sent</div>
    </div>
    <div class="data-row">
        <div class="transaction-accepted">accepted</div>
    </div>
    <div class="data-row">
        <div class="transaction-processed">processed</div>
    </div>
    <div class="data-row">
        <div style="border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem;"
             class="transaction-failed">failed</div>
    </div>
</div>

<p>
    The following table will show the states of the transactions as they are generated and processed. Currently, the
    transactions progress only to <span class="transaction-generated">generated</span>.
</p>

<div id="transaction-table" class="table">

    <div class="header-row">
        <div>transaction</div>
        <div>state</div>
    </div>

    <div class="data-row">
        <div>1</div>
        <div class="transaction-waiting">waiting</div>
    </div>

    <div class="data-row">
        <div>2</div>
        <div class="transaction-waiting">waiting</div>
    </div>

    <div class="data-row">
        <div>3</div>
        <div class="transaction-waiting">waiting</div>
    </div>

    <div class="data-row">
        <div>4</div>
        <div class="transaction-waiting">waiting</div>
    </div>

    <div class="data-row">
        <div>5</div>
        <div class="transaction-waiting" style="border-bottom-right-radius: 0.5rem;">waiting</div>
    </div>

</div>

<script>
    const maximumNumberOfTransactions = 5;
    var i = 0;

    function generateTransaction() {
        // Generate the transaction.
        var detail = {
            clientUrl: 'https://client.nyzo.co/api/forwardTransaction',
            receiverId: 'id__8cdasPC2QVZ13iG42RWhp47gow9SsIXZgp0Aga59oEITG2X-M7Ur',
            tag: 'game-example-' + i
        };
        const event = new CustomEvent('nyzo-transaction', { detail: detail });
        document.dispatchEvent(event);
        setState(i, 'generated');

        // Increment the index. If not at the maximum number of transactions, schedule another iteration in 10 seconds.
        i++;
        if (i < maximumNumberOfTransactions) {
            setTimeout(generateTransaction, 5000);
        }
    }

    function setState(index, state) {
        var table = document.getElementById('transaction-table');
        var row = table.children[index + 1];
        var cell = row.children[1];
        cell.className = 'transaction-' + state;
        cell.innerHTML = state;
    }

    // Generate the first transaction after a 1.5-second delay.
    setTimeout(generateTransaction, 1500);
</script>

<p class="italic">
    This page is under active development as a demonstration of the development process for building applications on
    Nyzo.
</p>