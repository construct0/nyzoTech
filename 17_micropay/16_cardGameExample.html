<link rel="stylesheet" type="text/css" href="../style.css">

<h1>Card game example</h1>

<style>
    .board {
        width: 100%;
        min-width: 300px;
        max-width: 600px;
        margin: auto;
        display: block;
    }
</style>

<canvas id="board" class="board" width="1600" height="1200">
</canvas>

<script>
    const club = 0;
    const diamond = 1;
    const heart = 2;
    const spade = 3;

    function configureBoardForCurrentState() {
        let board = document.getElementById('board');
        let context = board.getContext('2d');

        let width = board.width;
        let height = board.height;

        // Draw the background.
        let xc = width / 2;
        let yc = height / 2;
        let r0 = 0;
        let r1 = width / 2;
        let gradient = context.createRadialGradient(xc, yc, r0, xc, yc, r1);
        gradient.addColorStop(0, '#080');
        gradient.addColorStop(1, '#040');
        context.fillStyle = gradient;
        context.fillRect(0, 0, width, height);

        // Draw the cards. Currently drawing the whole deck for development purposes.
        let cardWidth = width * 0.08;
        let cardHeight = cardWidth * 7.0 / 5.0;
        const cardsInDeck = 52;
        const cardsPerRow = 9;
        const numberOfRows = Math.ceil(cardsInDeck / cardsPerRow);
        let hGap = (width - cardWidth * cardsPerRow) / (cardsPerRow + 1.0);
        let vGap = (height - cardHeight * numberOfRows) / (numberOfRows + 1.0);
        for (let i = 0; i < 52; i++) {
            let column = i % cardsPerRow;
            let row = Math.floor(i / cardsPerRow);
            let x0 = (column + 1.0) * hGap + column * cardWidth;
            let y0 = (row + 1.0) * vGap + row * cardHeight;
            let rank = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'][i % 13];
            let suit = Math.floor(i / 13);
            drawCard(context, x0, y0, cardWidth, cardHeight, rank, suit);
        }
    }

    function drawCard(context, x0, y0, width, height, rank, suit) {
        // Draw the background.
        context.fillStyle = 'white';
        context.fillRect(x0, y0, width, height);

        // Draw the rank.
        context.font = '900 ' + Math.ceil(width * 0.3) + 'px sans-serif';
        context.fontWeight = 'bold';
        context.fillStyle = suit == club || suit == spade ? 'black' : 'red';
        const xRank = x0 + width * 0.1;
        const yRank = y0 + height * 0.27;
        context.fillText(rank, xRank, yRank);

        // Draw the suit. The loop is a binary search to find the correct font size.
        let suitLetter = ['\u2663', '\u2666', '\u2665', '\u2660'][suit];
        const targetWidth = width * 0.6;
        let sizeLow = width * 0.5;
        let sizeHigh = width * 2.0;
        for (let i = 0; i < 10; i++) {
            console.log('low: ' + sizeLow + ', high: ' + sizeHigh);
            let sizeMid = (sizeLow + sizeHigh) / 2.0;
            context.font = '900 ' + sizeMid + 'px sans-serif';
            let metrics = context.measureText(suitLetter);
            if (metrics.width > targetWidth) {
                sizeHigh = sizeMid;
            } else {
                sizeLow = sizeMid;
            }
            console.log(i + ': sizeMid=' + sizeMid);
        }
        let suitSize = (sizeLow + sizeHigh) / 2.0;
        context.font = '900 ' + ((sizeLow + sizeHigh) / 2.0) + 'px sans-serif';
        let suitWidth = context.measureText(suitLetter).width;
        let suitHeight = context.measureText('M').width;
        context.fillText(suitLetter, x0 + width * 0.5 - suitWidth * 0.5, y0 + height * 0.5 + suitHeight * 0.45);
    }

    configureBoardForCurrentState();
</script>

<p>
    This page will build upon the <a href="gameExample">tic-tac-toe game example</a> to create a multiplayer card game
    that is played on the Nyzo blockchain.
</p>

<p class="italic">
    This page is in active development to demonstrate multiplayer gaming on the Nyzo blockchain.
</p>